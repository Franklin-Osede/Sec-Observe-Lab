{"ast":null,"code":"import _asyncToGenerator from \"/Users/domoblock/Documents/Projycto/sec-observe-lab/01-monitoring-stack/biometric-auth/angular-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport { BehaviorSubject } from 'rxjs';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/common/http\";\nexport let MetricsService = /*#__PURE__*/(() => {\n  class MetricsService {\n    constructor(http) {\n      this.http = http;\n      this.API_BASE = 'http://localhost:3001/api/v1';\n      this.PROMETHEUS_BASE = 'http://localhost:9090/api/v1';\n      this.metricsSubject = new BehaviorSubject(null);\n      this.metrics$ = this.metricsSubject.asObservable();\n    }\n    getMetrics() {\n      var _this = this;\n      return _asyncToGenerator(function* () {\n        try {\n          const response = yield _this.http.get(`${_this.API_BASE}/metrics`).toPromise();\n          return _this.parseMetrics(response);\n        } catch (error) {\n          console.error('Error obteniendo métricas:', error);\n          return _this.getDefaultMetrics();\n        }\n      })();\n    }\n    parseMetrics(metricsText) {\n      const lines = metricsText.split('\\n');\n      const metrics = {};\n      lines.forEach(line => {\n        if (line.startsWith('#') || line.trim() === '') return;\n        const [metricName, value] = line.split(' ');\n        if (metricName && value) {\n          const numericValue = parseFloat(value);\n          if (!isNaN(numericValue)) {\n            metrics[metricName] = numericValue;\n          }\n        }\n      });\n      return {\n        biometric_auth_attempts_total: metrics.biometric_auth_attempts_total || 0,\n        biometric_auth_duration_seconds: metrics.biometric_auth_duration_seconds || 0,\n        webauthn_registration_total: metrics.webauthn_registration_total || 0,\n        webauthn_authentication_total: metrics.webauthn_authentication_total || 0,\n        fingerprint_recognition_total: metrics.fingerprint_recognition_total || 0,\n        face_recognition_total: metrics.face_recognition_total || 0,\n        qr_code_generation_total: metrics.qr_code_generation_total || 0,\n        qr_code_validation_total: metrics.qr_code_validation_total || 0,\n        system_uptime: metrics.system_uptime || 0,\n        redis_connections: metrics.redis_connections || 0\n      };\n    }\n    getDefaultMetrics() {\n      return {\n        biometric_auth_attempts_total: 0,\n        biometric_auth_duration_seconds: 0,\n        webauthn_registration_total: 0,\n        webauthn_authentication_total: 0,\n        fingerprint_recognition_total: 0,\n        face_recognition_total: 0,\n        qr_code_generation_total: 0,\n        qr_code_validation_total: 0,\n        system_uptime: 0,\n        redis_connections: 0\n      };\n    }\n    refreshMetrics() {\n      var _this2 = this;\n      return _asyncToGenerator(function* () {\n        try {\n          const metrics = yield _this2.getMetrics();\n          _this2.metricsSubject.next(metrics);\n        } catch (error) {\n          console.error('Error actualizando métricas:', error);\n        }\n      })();\n    }\n    static {\n      this.ɵfac = function MetricsService_Factory(t) {\n        return new (t || MetricsService)(i0.ɵɵinject(i1.HttpClient));\n      };\n    }\n    static {\n      this.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n        token: MetricsService,\n        factory: MetricsService.ɵfac,\n        providedIn: 'root'\n      });\n    }\n  }\n  return MetricsService;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}