{"ast":null,"code":"import _asyncToGenerator from \"/Users/domoblock/Documents/Projycto/sec-observe-lab/01-monitoring-stack/biometric-auth/angular-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport { EventEmitter } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule } from '@angular/forms';\nimport { MatCardModule } from '@angular/material/card';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatProgressSpinnerModule } from '@angular/material/progress-spinner';\nimport { MatSnackBarModule } from '@angular/material/snack-bar';\nimport { MatTabsModule } from '@angular/material/tabs';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"../../services/biometric.service\";\nimport * as i2 from \"@angular/material/snack-bar\";\nimport * as i3 from \"@angular/common\";\nimport * as i4 from \"@angular/forms\";\nimport * as i5 from \"@angular/material/card\";\nimport * as i6 from \"@angular/material/button\";\nimport * as i7 from \"@angular/material/icon\";\nimport * as i8 from \"@angular/material/progress-spinner\";\nfunction WebauthnComponent_div_10_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 14)(1, \"div\", 15)(2, \"mat-icon\");\n    i0.ɵɵtext(3);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(4, \"span\");\n    i0.ɵɵtext(5);\n    i0.ɵɵelementEnd()()();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance();\n    i0.ɵɵclassProp(\"success\", ctx_r0.currentStatus.success)(\"error\", !ctx_r0.currentStatus.success);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(ctx_r0.currentStatus.success ? \"check_circle\" : \"error\");\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate2(\"\", ctx_r0.currentStatus.method, \": \", ctx_r0.currentStatus.success ? \"Exitoso\" : \"Fall\\u00F3\", \"\");\n  }\n}\nfunction WebauthnComponent_div_11_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 16)(1, \"mat-icon\", 17);\n    i0.ɵɵtext(2, \"warning\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"p\");\n    i0.ɵɵtext(4, \"WebAuthn no est\\u00E1 soportado en este navegador\");\n    i0.ɵɵelementEnd()();\n  }\n}\nfunction WebauthnComponent_div_59_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 18);\n    i0.ɵɵelement(1, \"mat-spinner\", 19);\n    i0.ɵɵelementStart(2, \"p\");\n    i0.ɵɵtext(3, \"Procesando...\");\n    i0.ɵɵelementEnd()();\n  }\n}\nexport let WebauthnComponent = /*#__PURE__*/(() => {\n  class WebauthnComponent {\n    constructor(biometricService, snackBar) {\n      this.biometricService = biometricService;\n      this.snackBar = snackBar;\n      this.username = '';\n      this.statusChange = new EventEmitter();\n      this.isLoading = false;\n      this.isWebAuthnSupported = false;\n      this.currentStatus = null;\n      this.biometricSupport = {};\n      this.registrationData = {\n        displayName: ''\n      };\n      this.registrationChallenge = null;\n      this.authenticationChallenge = null;\n    }\n    ngOnInit() {\n      var _this = this;\n      return _asyncToGenerator(function* () {\n        _this.isWebAuthnSupported = _this.biometricService.isWebAuthnSupported();\n        _this.biometricSupport = yield _this.biometricService.checkBiometricSupport();\n        if (_this.username) {\n          _this.registrationData.displayName = _this.username;\n        }\n      })();\n    }\n    beginRegistration() {\n      var _this2 = this;\n      return _asyncToGenerator(function* () {\n        if (!_this2.username) {\n          _this2.snackBar.open('❌ Usuario requerido', 'Cerrar', {\n            duration: 3000\n          });\n          return;\n        }\n        _this2.isLoading = true;\n        try {\n          const result = yield _this2.biometricService.beginWebAuthnRegistration(_this2.username, _this2.registrationData.displayName);\n          _this2.currentStatus = result;\n          _this2.statusChange.emit(result);\n          if (result.success) {\n            _this2.registrationChallenge = result.data;\n            _this2.snackBar.open('✅ Registro iniciado', 'Cerrar', {\n              duration: 3000\n            });\n          } else {\n            _this2.snackBar.open(`❌ Error: ${result.error}`, 'Cerrar', {\n              duration: 5000\n            });\n          }\n        } catch (error) {\n          _this2.snackBar.open(`❌ Error: ${error.message}`, 'Cerrar', {\n            duration: 5000\n          });\n        } finally {\n          _this2.isLoading = false;\n        }\n      })();\n    }\n    completeRegistration() {\n      var _this3 = this;\n      return _asyncToGenerator(function* () {\n        if (!_this3.registrationChallenge) {\n          _this3.snackBar.open('❌ No hay registro iniciado', 'Cerrar', {\n            duration: 3000\n          });\n          return;\n        }\n        _this3.isLoading = true;\n        try {\n          // Crear credencial usando WebAuthn API del navegador\n          const credential = yield _this3.biometricService.createWebAuthnCredential(_this3.registrationChallenge.challenge, _this3.registrationChallenge.user);\n          const result = yield _this3.biometricService.completeWebAuthnRegistration(credential);\n          _this3.currentStatus = result;\n          _this3.statusChange.emit(result);\n          if (result.success) {\n            _this3.snackBar.open('✅ Registro completado', 'Cerrar', {\n              duration: 3000\n            });\n            _this3.registrationChallenge = null;\n          } else {\n            _this3.snackBar.open(`❌ Error: ${result.error}`, 'Cerrar', {\n              duration: 5000\n            });\n          }\n        } catch (error) {\n          _this3.snackBar.open(`❌ Error: ${error.message}`, 'Cerrar', {\n            duration: 5000\n          });\n        } finally {\n          _this3.isLoading = false;\n        }\n      })();\n    }\n    beginAuthentication() {\n      var _this4 = this;\n      return _asyncToGenerator(function* () {\n        if (!_this4.username) {\n          _this4.snackBar.open('❌ Usuario requerido', 'Cerrar', {\n            duration: 3000\n          });\n          return;\n        }\n        _this4.isLoading = true;\n        try {\n          const result = yield _this4.biometricService.beginWebAuthnAuthentication(_this4.username);\n          _this4.currentStatus = result;\n          _this4.statusChange.emit(result);\n          if (result.success) {\n            _this4.authenticationChallenge = result.data;\n            _this4.snackBar.open('✅ Autenticación iniciada', 'Cerrar', {\n              duration: 3000\n            });\n          } else {\n            _this4.snackBar.open(`❌ Error: ${result.error}`, 'Cerrar', {\n              duration: 5000\n            });\n          }\n        } catch (error) {\n          _this4.snackBar.open(`❌ Error: ${error.message}`, 'Cerrar', {\n            duration: 5000\n          });\n        } finally {\n          _this4.isLoading = false;\n        }\n      })();\n    }\n    completeAuthentication() {\n      var _this5 = this;\n      return _asyncToGenerator(function* () {\n        if (!_this5.authenticationChallenge) {\n          _this5.snackBar.open('❌ No hay autenticación iniciada', 'Cerrar', {\n            duration: 3000\n          });\n          return;\n        }\n        _this5.isLoading = true;\n        try {\n          // Obtener aserción usando WebAuthn API del navegador\n          const assertion = yield _this5.biometricService.getWebAuthnAssertion(_this5.authenticationChallenge.challenge, _this5.authenticationChallenge.allowCredentials || []);\n          const result = yield _this5.biometricService.completeWebAuthnAuthentication(assertion);\n          _this5.currentStatus = result;\n          _this5.statusChange.emit(result);\n          if (result.success) {\n            _this5.snackBar.open('✅ Autenticación exitosa', 'Cerrar', {\n              duration: 3000\n            });\n            _this5.authenticationChallenge = null;\n          } else {\n            _this5.snackBar.open(`❌ Error: ${result.error}`, 'Cerrar', {\n              duration: 5000\n            });\n          }\n        } catch (error) {\n          _this5.snackBar.open(`❌ Error: ${error.message}`, 'Cerrar', {\n            duration: 5000\n          });\n        } finally {\n          _this5.isLoading = false;\n        }\n      })();\n    }\n    static {\n      this.ɵfac = function WebauthnComponent_Factory(t) {\n        return new (t || WebauthnComponent)(i0.ɵɵdirectiveInject(i1.BiometricService), i0.ɵɵdirectiveInject(i2.MatSnackBar));\n      };\n    }\n    static {\n      this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n        type: WebauthnComponent,\n        selectors: [[\"app-webauthn\"]],\n        inputs: {\n          username: \"username\"\n        },\n        outputs: {\n          statusChange: \"statusChange\"\n        },\n        standalone: true,\n        features: [i0.ɵɵStandaloneFeature],\n        decls: 60,\n        vars: 14,\n        consts: [[1, \"webauthn-container\"], [1, \"webauthn-card\"], [\"class\", \"status-section\", 4, \"ngIf\"], [\"class\", \"support-check\", 4, \"ngIf\"], [1, \"registration-section\"], [1, \"input-group\"], [\"type\", \"text\", \"placeholder\", \"Nombre para mostrar\", 1, \"user-input\", 3, \"ngModelChange\", \"ngModel\"], [\"mat-raised-button\", \"\", \"color\", \"primary\", 3, \"click\", \"disabled\"], [\"mat-raised-button\", \"\", \"color\", \"accent\", 3, \"click\", \"disabled\"], [1, \"authentication-section\"], [1, \"biometric-info\"], [1, \"support-grid\"], [1, \"support-item\"], [\"class\", \"loading-section\", 4, \"ngIf\"], [1, \"status-section\"], [1, \"status-item\"], [1, \"support-check\"], [\"color\", \"warn\"], [1, \"loading-section\"], [\"diameter\", \"40\"]],\n        template: function WebauthnComponent_Template(rf, ctx) {\n          if (rf & 1) {\n            i0.ɵɵelementStart(0, \"div\", 0)(1, \"mat-card\", 1)(2, \"mat-card-header\")(3, \"mat-card-title\")(4, \"mat-icon\");\n            i0.ɵɵtext(5, \"security\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵtext(6, \" WebAuthn - Autenticaci\\u00F3n Biom\\u00E9trica \");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(7, \"mat-card-subtitle\");\n            i0.ɵɵtext(8, \" Usa tu huella dactilar, Face ID o llave de seguridad \");\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelementStart(9, \"mat-card-content\");\n            i0.ɵɵtemplate(10, WebauthnComponent_div_10_Template, 6, 7, \"div\", 2)(11, WebauthnComponent_div_11_Template, 5, 0, \"div\", 3);\n            i0.ɵɵelementStart(12, \"div\", 4)(13, \"h3\");\n            i0.ɵɵtext(14, \"\\uD83D\\uDD11 Registro WebAuthn\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(15, \"p\");\n            i0.ɵɵtext(16, \"Registra tu dispositivo para autenticaci\\u00F3n biom\\u00E9trica\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(17, \"div\", 5)(18, \"input\", 6);\n            i0.ɵɵtwoWayListener(\"ngModelChange\", function WebauthnComponent_Template_input_ngModelChange_18_listener($event) {\n              i0.ɵɵtwoWayBindingSet(ctx.registrationData.displayName, $event) || (ctx.registrationData.displayName = $event);\n              return $event;\n            });\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelementStart(19, \"button\", 7);\n            i0.ɵɵlistener(\"click\", function WebauthnComponent_Template_button_click_19_listener() {\n              return ctx.beginRegistration();\n            });\n            i0.ɵɵelementStart(20, \"mat-icon\");\n            i0.ɵɵtext(21, \"person_add\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵtext(22, \" Iniciar Registro \");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(23, \"button\", 8);\n            i0.ɵɵlistener(\"click\", function WebauthnComponent_Template_button_click_23_listener() {\n              return ctx.completeRegistration();\n            });\n            i0.ɵɵelementStart(24, \"mat-icon\");\n            i0.ɵɵtext(25, \"check\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵtext(26, \" Completar Registro \");\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelementStart(27, \"div\", 9)(28, \"h3\");\n            i0.ɵɵtext(29, \"\\uD83D\\uDD10 Autenticaci\\u00F3n WebAuthn\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(30, \"p\");\n            i0.ɵɵtext(31, \"Autentica usando tu dispositivo registrado\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(32, \"button\", 7);\n            i0.ɵɵlistener(\"click\", function WebauthnComponent_Template_button_click_32_listener() {\n              return ctx.beginAuthentication();\n            });\n            i0.ɵɵelementStart(33, \"mat-icon\");\n            i0.ɵɵtext(34, \"fingerprint\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵtext(35, \" Iniciar Autenticaci\\u00F3n \");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(36, \"button\", 8);\n            i0.ɵɵlistener(\"click\", function WebauthnComponent_Template_button_click_36_listener() {\n              return ctx.completeAuthentication();\n            });\n            i0.ɵɵelementStart(37, \"mat-icon\");\n            i0.ɵɵtext(38, \"verified\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵtext(39, \" Completar Autenticaci\\u00F3n \");\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelementStart(40, \"div\", 10)(41, \"h4\");\n            i0.ɵɵtext(42, \"\\uD83D\\uDCF1 M\\u00E9todos Soportados:\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(43, \"div\", 11)(44, \"div\", 12)(45, \"mat-icon\");\n            i0.ɵɵtext(46, \"fingerprint\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(47, \"span\");\n            i0.ɵɵtext(48, \"Huella Dactilar\");\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelementStart(49, \"div\", 12)(50, \"mat-icon\");\n            i0.ɵɵtext(51, \"face\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(52, \"span\");\n            i0.ɵɵtext(53, \"Reconocimiento Facial\");\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelementStart(54, \"div\", 12)(55, \"mat-icon\");\n            i0.ɵɵtext(56, \"security\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(57, \"span\");\n            i0.ɵɵtext(58, \"WebAuthn\");\n            i0.ɵɵelementEnd()()()();\n            i0.ɵɵtemplate(59, WebauthnComponent_div_59_Template, 4, 0, \"div\", 13);\n            i0.ɵɵelementEnd()()();\n          }\n          if (rf & 2) {\n            i0.ɵɵadvance(10);\n            i0.ɵɵproperty(\"ngIf\", ctx.currentStatus);\n            i0.ɵɵadvance();\n            i0.ɵɵproperty(\"ngIf\", !ctx.isWebAuthnSupported);\n            i0.ɵɵadvance(7);\n            i0.ɵɵtwoWayProperty(\"ngModel\", ctx.registrationData.displayName);\n            i0.ɵɵadvance();\n            i0.ɵɵproperty(\"disabled\", ctx.isLoading || !ctx.isWebAuthnSupported);\n            i0.ɵɵadvance(4);\n            i0.ɵɵproperty(\"disabled\", ctx.isLoading || !ctx.registrationChallenge);\n            i0.ɵɵadvance(9);\n            i0.ɵɵproperty(\"disabled\", ctx.isLoading || !ctx.isWebAuthnSupported);\n            i0.ɵɵadvance(4);\n            i0.ɵɵproperty(\"disabled\", ctx.isLoading || !ctx.authenticationChallenge);\n            i0.ɵɵadvance(8);\n            i0.ɵɵclassProp(\"supported\", ctx.biometricSupport.fingerprint);\n            i0.ɵɵadvance(5);\n            i0.ɵɵclassProp(\"supported\", ctx.biometricSupport.face);\n            i0.ɵɵadvance(5);\n            i0.ɵɵclassProp(\"supported\", ctx.biometricSupport.webauthn);\n            i0.ɵɵadvance(5);\n            i0.ɵɵproperty(\"ngIf\", ctx.isLoading);\n          }\n        },\n        dependencies: [CommonModule, i3.NgIf, FormsModule, i4.DefaultValueAccessor, i4.NgControlStatus, i4.NgModel, MatCardModule, i5.MatCard, i5.MatCardContent, i5.MatCardHeader, i5.MatCardSubtitle, i5.MatCardTitle, MatButtonModule, i6.MatButton, MatIconModule, i7.MatIcon, MatProgressSpinnerModule, i8.MatProgressSpinner, MatSnackBarModule, MatTabsModule],\n        styles: [\".webauthn-container[_ngcontent-%COMP%]{padding:1rem}.webauthn-card[_ngcontent-%COMP%]{max-width:800px;margin:0 auto}.status-section[_ngcontent-%COMP%]{margin:1rem 0}.status-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px;padding:10px;border-radius:10px;background:#f5f5f5;margin:10px 0}.status-item.success[_ngcontent-%COMP%]{background:#d4edda;color:#155724}.status-item.error[_ngcontent-%COMP%]{background:#f8d7da;color:#721c24}.support-check[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px;padding:10px;background:#fff3cd;border:1px solid #ffeaa7;border-radius:10px;margin:1rem 0}.registration-section[_ngcontent-%COMP%], .authentication-section[_ngcontent-%COMP%]{margin:2rem 0;padding:1.5rem;border:2px solid #f0f0f0;border-radius:15px;transition:var(--transition)}.registration-section[_ngcontent-%COMP%]:hover, .authentication-section[_ngcontent-%COMP%]:hover{border-color:var(--primary-color)}.input-group[_ngcontent-%COMP%]{margin:1rem 0}.user-input[_ngcontent-%COMP%]{width:100%;padding:12px;border:2px solid #ddd;border-radius:10px;font-size:1em;transition:var(--transition)}.user-input[_ngcontent-%COMP%]:focus{outline:none;border-color:var(--primary-color)}.biometric-info[_ngcontent-%COMP%]{margin:2rem 0;padding:1.5rem;background:#f8f9fa;border-radius:15px}.support-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(150px,1fr));gap:1rem;margin:1rem 0}.support-item[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;gap:10px;padding:1rem;border:2px solid #ddd;border-radius:10px;transition:var(--transition)}.support-item.supported[_ngcontent-%COMP%]{border-color:var(--success-color);background:#d4edda}.loading-section[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;gap:1rem;margin:2rem 0}@media (max-width: 768px){.support-grid[_ngcontent-%COMP%]{grid-template-columns:1fr}}\"]\n      });\n    }\n  }\n  return WebauthnComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}