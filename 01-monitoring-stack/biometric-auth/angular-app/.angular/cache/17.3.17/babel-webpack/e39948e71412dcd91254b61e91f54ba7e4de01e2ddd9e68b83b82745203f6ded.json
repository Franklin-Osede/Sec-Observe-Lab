{"ast":null,"code":"import _asyncToGenerator from \"/Users/domoblock/Documents/Projycto/sec-observe-lab/01-monitoring-stack/biometric-auth/angular-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport { HttpHeaders } from '@angular/common/http';\nimport { BehaviorSubject } from 'rxjs';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/common/http\";\nexport let BiometricService = /*#__PURE__*/(() => {\n  class BiometricService {\n    constructor(http) {\n      this.http = http;\n      this.API_BASE = 'http://localhost:3001/api/v1';\n      this.httpOptions = {\n        headers: new HttpHeaders({\n          'Content-Type': 'application/json'\n        })\n      };\n      this.statusSubject = new BehaviorSubject(null);\n      this.status$ = this.statusSubject.asObservable();\n    }\n    // WebAuthn Methods\n    beginWebAuthnRegistration(username, displayName) {\n      var _this = this;\n      return _asyncToGenerator(function* () {\n        try {\n          const response = yield _this.http.post(`${_this.API_BASE}/webauthn/register/begin`, {\n            username,\n            displayName\n          }, _this.httpOptions).toPromise();\n          const result = {\n            success: true,\n            data: response,\n            method: 'WebAuthn Registration',\n            timestamp: new Date()\n          };\n          _this.statusSubject.next(result);\n          return result;\n        } catch (error) {\n          const result = {\n            success: false,\n            error: error.message || 'Error en registro WebAuthn',\n            method: 'WebAuthn Registration',\n            timestamp: new Date()\n          };\n          _this.statusSubject.next(result);\n          return result;\n        }\n      })();\n    }\n    completeWebAuthnRegistration(credential) {\n      var _this2 = this;\n      return _asyncToGenerator(function* () {\n        try {\n          const response = yield _this2.http.post(`${_this2.API_BASE}/webauthn/register/complete`, {\n            credential\n          }, _this2.httpOptions).toPromise();\n          const result = {\n            success: true,\n            data: response,\n            method: 'WebAuthn Registration Complete',\n            timestamp: new Date()\n          };\n          _this2.statusSubject.next(result);\n          return result;\n        } catch (error) {\n          const result = {\n            success: false,\n            error: error.message || 'Error completando registro WebAuthn',\n            method: 'WebAuthn Registration Complete',\n            timestamp: new Date()\n          };\n          _this2.statusSubject.next(result);\n          return result;\n        }\n      })();\n    }\n    beginWebAuthnAuthentication(username) {\n      var _this3 = this;\n      return _asyncToGenerator(function* () {\n        try {\n          const response = yield _this3.http.post(`${_this3.API_BASE}/webauthn/authenticate/begin`, {\n            username\n          }, _this3.httpOptions).toPromise();\n          const result = {\n            success: true,\n            data: response,\n            method: 'WebAuthn Authentication',\n            timestamp: new Date()\n          };\n          _this3.statusSubject.next(result);\n          return result;\n        } catch (error) {\n          const result = {\n            success: false,\n            error: error.message || 'Error en autenticación WebAuthn',\n            method: 'WebAuthn Authentication',\n            timestamp: new Date()\n          };\n          _this3.statusSubject.next(result);\n          return result;\n        }\n      })();\n    }\n    completeWebAuthnAuthentication(assertion) {\n      var _this4 = this;\n      return _asyncToGenerator(function* () {\n        try {\n          const response = yield _this4.http.post(`${_this4.API_BASE}/webauthn/authenticate/complete`, {\n            assertion\n          }, _this4.httpOptions).toPromise();\n          const result = {\n            success: true,\n            data: response,\n            method: 'WebAuthn Authentication Complete',\n            timestamp: new Date()\n          };\n          _this4.statusSubject.next(result);\n          return result;\n        } catch (error) {\n          const result = {\n            success: false,\n            error: error.message || 'Error completando autenticación WebAuthn',\n            method: 'WebAuthn Authentication Complete',\n            timestamp: new Date()\n          };\n          _this4.statusSubject.next(result);\n          return result;\n        }\n      })();\n    }\n    // Fingerprint Methods\n    recognizeFingerprint(username, fingerprintData) {\n      var _this5 = this;\n      return _asyncToGenerator(function* () {\n        try {\n          const response = yield _this5.http.post(`${_this5.API_BASE}/fingerprint/recognize`, {\n            username,\n            fingerprintData\n          }, _this5.httpOptions).toPromise();\n          const result = {\n            success: true,\n            data: response,\n            method: 'Fingerprint Recognition',\n            timestamp: new Date()\n          };\n          _this5.statusSubject.next(result);\n          return result;\n        } catch (error) {\n          const result = {\n            success: false,\n            error: error.message || 'Error en reconocimiento de huella',\n            method: 'Fingerprint Recognition',\n            timestamp: new Date()\n          };\n          _this5.statusSubject.next(result);\n          return result;\n        }\n      })();\n    }\n    // Face Recognition Methods\n    recognizeFace(username, faceData) {\n      var _this6 = this;\n      return _asyncToGenerator(function* () {\n        try {\n          const response = yield _this6.http.post(`${_this6.API_BASE}/face/recognize`, {\n            username,\n            faceData\n          }, _this6.httpOptions).toPromise();\n          const result = {\n            success: true,\n            data: response,\n            method: 'Face Recognition',\n            timestamp: new Date()\n          };\n          _this6.statusSubject.next(result);\n          return result;\n        } catch (error) {\n          const result = {\n            success: false,\n            error: error.message || 'Error en reconocimiento facial',\n            method: 'Face Recognition',\n            timestamp: new Date()\n          };\n          _this6.statusSubject.next(result);\n          return result;\n        }\n      })();\n    }\n    // QR Code Methods\n    generateQRCode(username, data) {\n      var _this7 = this;\n      return _asyncToGenerator(function* () {\n        try {\n          const response = yield _this7.http.post(`${_this7.API_BASE}/qr/generate`, {\n            username,\n            data\n          }, _this7.httpOptions).toPromise();\n          const result = {\n            success: true,\n            data: response,\n            method: 'QR Code Generation',\n            timestamp: new Date()\n          };\n          _this7.statusSubject.next(result);\n          return result;\n        } catch (error) {\n          const result = {\n            success: false,\n            error: error.message || 'Error generando código QR',\n            method: 'QR Code Generation',\n            timestamp: new Date()\n          };\n          _this7.statusSubject.next(result);\n          return result;\n        }\n      })();\n    }\n    validateQRCode(username, qrData) {\n      var _this8 = this;\n      return _asyncToGenerator(function* () {\n        try {\n          const response = yield _this8.http.post(`${_this8.API_BASE}/qr/validate`, {\n            username,\n            qrData\n          }, _this8.httpOptions).toPromise();\n          const result = {\n            success: true,\n            data: response,\n            method: 'QR Code Validation',\n            timestamp: new Date()\n          };\n          _this8.statusSubject.next(result);\n          return result;\n        } catch (error) {\n          const result = {\n            success: false,\n            error: error.message || 'Error validando código QR',\n            method: 'QR Code Validation',\n            timestamp: new Date()\n          };\n          _this8.statusSubject.next(result);\n          return result;\n        }\n      })();\n    }\n    // System Health\n    checkHealth() {\n      var _this9 = this;\n      return _asyncToGenerator(function* () {\n        try {\n          const response = yield _this9.http.get(`${_this9.API_BASE}/health`, _this9.httpOptions).toPromise();\n          return response;\n        } catch (error) {\n          throw new Error(`Error verificando salud del sistema: ${error.message}`);\n        }\n      })();\n    }\n    // WebAuthn Browser API Integration\n    createWebAuthnCredential(challenge, user) {\n      var _this0 = this;\n      return _asyncToGenerator(function* () {\n        try {\n          const credential = yield navigator.credentials.create({\n            publicKey: {\n              challenge: _this0.base64ToArrayBuffer(challenge),\n              rp: {\n                name: \"Sec-Observe-Lab\",\n                id: \"localhost\"\n              },\n              user: {\n                id: new TextEncoder().encode(user.id),\n                name: user.name,\n                displayName: user.displayName\n              },\n              pubKeyCredParams: [{\n                type: \"public-key\",\n                alg: -7\n              }, {\n                type: \"public-key\",\n                alg: -257\n              } // RS256\n              ],\n              authenticatorSelection: {\n                authenticatorAttachment: \"platform\",\n                userVerification: \"preferred\"\n              },\n              timeout: 60000,\n              attestation: \"direct\"\n            }\n          });\n          return {\n            id: credential.id,\n            type: credential.type,\n            rawId: _this0.arrayBufferToBase64(credential.rawId),\n            response: {\n              attestationObject: _this0.arrayBufferToBase64(credential.response.attestationObject),\n              clientDataJSON: _this0.arrayBufferToBase64(credential.response.clientDataJSON)\n            }\n          };\n        } catch (error) {\n          throw new Error(`Error creando credencial WebAuthn: ${error.message}`);\n        }\n      })();\n    }\n    getWebAuthnAssertion(challenge, allowCredentials) {\n      var _this1 = this;\n      return _asyncToGenerator(function* () {\n        try {\n          const assertion = yield navigator.credentials.get({\n            publicKey: {\n              challenge: _this1.base64ToArrayBuffer(challenge),\n              allowCredentials: allowCredentials.map(cred => ({\n                id: _this1.base64ToArrayBuffer(cred.id),\n                type: \"public-key\",\n                transports: [\"internal\", \"usb\", \"nfc\", \"ble\"]\n              })),\n              timeout: 60000,\n              userVerification: \"preferred\"\n            }\n          });\n          return {\n            id: assertion.id,\n            type: assertion.type,\n            rawId: _this1.arrayBufferToBase64(assertion.rawId),\n            response: {\n              authenticatorData: _this1.arrayBufferToBase64(assertion.response.authenticatorData),\n              clientDataJSON: _this1.arrayBufferToBase64(assertion.response.clientDataJSON),\n              signature: _this1.arrayBufferToBase64(assertion.response.signature),\n              userHandle: _this1.arrayBufferToBase64(assertion.response.userHandle || new ArrayBuffer(0))\n            }\n          };\n        } catch (error) {\n          throw new Error(`Error obteniendo aserción WebAuthn: ${error.message}`);\n        }\n      })();\n    }\n    // Utility Methods\n    base64ToArrayBuffer(base64) {\n      const binaryString = atob(base64);\n      const bytes = new Uint8Array(binaryString.length);\n      for (let i = 0; i < binaryString.length; i++) {\n        bytes[i] = binaryString.charCodeAt(i);\n      }\n      return bytes.buffer;\n    }\n    arrayBufferToBase64(buffer) {\n      const bytes = new Uint8Array(buffer);\n      let binary = '';\n      for (let i = 0; i < bytes.byteLength; i++) {\n        binary += String.fromCharCode(bytes[i]);\n      }\n      return btoa(binary);\n    }\n    // Check WebAuthn Support\n    isWebAuthnSupported() {\n      return !!(navigator.credentials && navigator.credentials.create && navigator.credentials.get);\n    }\n    // Check Biometric Support\n    checkBiometricSupport() {\n      var _this10 = this;\n      return _asyncToGenerator(function* () {\n        return {\n          fingerprint: 'TouchID' in window || 'FingerprintJS' in window,\n          face: 'FaceID' in window || 'FaceRecognition' in window,\n          webauthn: _this10.isWebAuthnSupported()\n        };\n      })();\n    }\n    static {\n      this.ɵfac = function BiometricService_Factory(t) {\n        return new (t || BiometricService)(i0.ɵɵinject(i1.HttpClient));\n      };\n    }\n    static {\n      this.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n        token: BiometricService,\n        factory: BiometricService.ɵfac,\n        providedIn: 'root'\n      });\n    }\n  }\n  return BiometricService;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}